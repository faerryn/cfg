#!/bin/sh

set -euf

# get the swallowing node's id
swallower="$(bspc query -N -n)"

echo "${@}" | "${SHELL:-/bin/bash}" &

# wait until the new node appears
bspc subscribe node_add -c 1 >/dev/null

# hide the swallowing node
bspc node "${swallower}" -g hidden=on

# wait until the subprocess quites
wait

# unhind the swallowing node
bspc node "${swallower}" -g hidden=off
bspc node "${swallower}" -f
