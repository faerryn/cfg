#+TITLE: init.org
#+STARTUP: indent overview

* Prologue
** Disable default package manager
#+begin_src emacs-lisp
  (setq package-enable-at-startup nil)
#+end_src
** Install package manager
#+begin_src emacs-lisp
  (setq straight-use-symlinks t
        straight-disable-autoloads t)
  (defvar bootstrap-version)
  (let ((bootstrap-file (expand-file-name
                         "straight/repos/straight.el/bootstrap.el"
                         user-emacs-directory))
        (bootstrap-version 5))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer
          (url-retrieve-synchronously
           "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
           'silent 'inhibit-cookies)
        (goto-char (point-max))
        (eval-print-last-sexp)))
    (load bootstrap-file nil 'nomessage))
#+end_src
* User Interface
** Completion user interface
*** Vertical completion
#+begin_src emacs-lisp
  (straight-use-package 'selectrum)
  (require 'selectrum)
  (selectrum-mode +1)
#+end_src
*** Completion margin information
#+begin_src emacs-lisp
  (straight-use-package 'marginalia)
  (require 'marginalia)
  (marginalia-mode +1)
#+end_src
*** Completion sorting
#+begin_src emacs-lisp
  (straight-use-package 'orderless)
  (require 'orderless)
  (setq completion-styles '(orderless))
#+end_src
**** selectrum + orderless patch
#+begin_src emacs-lisp
  (setq selectrum-refine-candidates-function #'orderless-filter)
  (setq selectrum-highlight-candidates-function #'orderless-highlight-matches)
#+end_src
** Dark theme
#+begin_src emacs-lisp
  (straight-use-package 'doom-themes)
  (require 'doom-themes)
  (load-theme 'doom-one t)
#+end_src
** Default font
#+begin_src emacs-lisp
  (add-to-list 'default-frame-alist
               '(font . "monospace-12"))
#+end_src
** Disable extra user interface
#+begin_src emacs-lisp
  (setq inhibit-startup-screen t)
  (setq use-dialog-box nil)
  (menu-bar-mode -1)
  (when (featurep 'scroll-bar) (scroll-bar-mode -1))
  (tool-bar-mode -1)
  (add-hook 'window-setup-hook (lambda () (tooltip-mode -1)))
#+end_src
** Highlight matching parenthesis
#+begin_src emacs-lisp
  (show-paren-mode +1)
#+end_src
** Relative line numbers
#+begin_src emacs-lisp
  (setq display-line-numbers-type 'relative)
  (global-display-line-numbers-mode +1)
#+end_src
** Show key chords
#+begin_src emacs-lisp
  (straight-use-package 'which-key)
  (require 'which-key)
  (which-key-mode +1)
#+end_src
** Show whitespace
#+begin_src emacs-lisp
  (setq whitespace-style '(face trailing indentation big-indent))
  (global-whitespace-mode +1)
#+end_src
** Tab Bar
#+begin_src emacs-lisp
  (setq tab-bar-close-button nil)
  (setq tab-bar-new-button nil)
  (tab-bar-mode +1)
#+end_src
** Wrap lines
#+begin_src emacs-lisp
  (global-visual-line-mode +1)
#+end_src
* Editing
** Autocomplete paired characters
#+begin_src emacs-lisp
  (electric-pair-mode +1)
#+end_src
** Indentation
#+begin_src emacs-lisp
  (setq-default indent-tabs-mode nil
                tab-width 4)
  (straight-use-package 'dtrt-indent)
  (require 'dtrt-indent)
  (dtrt-indent-global-mode +1)
#+end_src
** Tab complete
#+begin_src emacs-lisp
  (setq tab-always-indent 'complete)
#+end_src
** Vim emulation
#+begin_src emacs-lisp
  (straight-use-package 'evil)
  (setq evil-want-Y-yank-to-eol t
        evil-want-keybinding nil
        evil-undo-system 'undo-redo)

  (require 'evil)
  (evil-mode +1)
#+end_src
*** Vim-style everything
#+begin_src emacs-lisp
  (straight-use-package 'evil-collection)
  (require 'evil-collection)

  (evil-collection-init)
#+end_src
* Major modes
** C/C++
#+begin_src emacs-lisp
  (with-eval-after-load "cc-mode"
    (define-key c-mode-map (kbd "TAB") #'indent-for-tab-command)
    (define-key c++-mode-map (kbd "TAB") #'indent-for-tab-command))
#+end_src
** Dired
#+begin_src emacs-lisp
  (setq dired-listing-switches "-l -hgvAFX --group-directories-first")
#+end_src
** Woman
#+begin_src emacs-lisp
  (when (executable-find "manpath")
    (with-eval-after-load "woman"
      (setq woman-manpath
            (woman-parse-colon-path
             (string-trim-right (shell-command-to-string "manpath -q") "\n")))))
#+end_src
** Sundry
#+begin_src emacs-lisp
  (straight-use-package 'lua-mode)
  (autoload 'lua-mode "lua-mode" "Major mode for editing lua code." t)
  (add-to-list 'auto-mode-alist '("\\.lua\\'" . lua-mode))
  (add-to-list 'interpreter-mode-alist '("lua" . lua-mode))

  (straight-use-package 'markdown-mode)
  (autoload 'markdown-mode "markdown-mode" "Major mode for editing Markdown files." t)
  (add-to-list
   'auto-mode-alist
   '("\\.\\(?:md\\|markdown\\|mkd\\|mdown\\|mkdn\\|mdwn\\)\\'" . markdown-mode))

  (straight-use-package 'rust-mode)
  (autoload 'rust-mode "rust-mode" "Major mode for Rust code." t)
  (add-to-list 'auto-mode-alist '("\\.rs\\'" . rust-mode))

  (straight-use-package 'zig-mode)
  (autoload 'zig-mode "zig-mode" "Major mode for the Zig programming language." t)
  (add-to-list 'auto-mode-alist '("\\.zig\\'" . zig-mode))
#+end_src
* Tools
** Git integration
*** Git client
#+begin_src emacs-lisp
  (straight-use-package 'magit)
  (autoload 'magit "magit" "An alias for ‘magit-status’ for better discoverability." t)
  (setq magit-define-global-key-bindings nil)
#+end_src
*** Git gutter
#+begin_src emacs-lisp
  (straight-use-package 'diff-hl)
  (setq diff-hl-command-prefix nil
        diff-hl-show-staged-changes nil)
  (require 'diff-hl)
  (require 'diff-hl-flydiff)
  (require 'diff-hl-margin)
  (global-diff-hl-mode +1)
  (diff-hl-flydiff-mode +1)
  (diff-hl-margin-mode +1)
#+end_src
*** diff-hl + magit patch
#+begin_src emacs-lisp
  (add-hook 'magit-pre-refresh-hook 'diff-hl-magit-pre-refresh)
  (add-hook 'magit-post-refresh-hook 'diff-hl-magit-post-refresh)
#+end_src
** Language server protocol
#+begin_src emacs-lisp
  (straight-use-package 'eglot)
  (autoload 'eglot "eglot" "Manage a project with a Language Server Protocol (LSP) server" t)
  (with-eval-after-load "eglot"
    (add-to-list 'eglot-server-programs '((c++-mode c-mode) "clangd"))
    (add-to-list 'eglot-server-programs '(rust-mode "rust-analyzer")))
#+end_src
* Miscellany
** Clean file system
#+begin_src emacs-lisp
  (setq backup-directory-alist
        `((".*" . ,(expand-file-name "backups/" user-emacs-directory))))
  (setq tramp-backup-directory-alist backup-directory-alist)
  (let ((auto-save-file-name-directory
         (expand-file-name "auto-saves/" user-emacs-directory)))
    (mkdir auto-save-file-name-directory t)
    (setq auto-save-file-name-transforms
          `((".*" ,auto-save-file-name-directory t))))
  (setq create-lockfiles nil)
#+end_src
** Disable saving passwords
#+begin_src emacs-lisp
  (setq auth-source-save-behavior nil)
#+end_src
** Don't cycle into non-file buffers
#+begin_src emacs-lisp
  (add-to-list 'default-frame-alist
               '(buffer-predicate . buffer-file-name))
#+end_src
** Follow symlinks
#+begin_src emacs-lisp
  (setq find-file-visit-truename t)
#+end_src
** Smarter garbage collection
#+begin_src emacs-lisp
  (straight-use-package 'gcmh)
  (require 'gcmh)
  (gcmh-mode +1)
#+end_src
** TTY support
*** Mouse support
#+begin_src emacs-lisp
  (add-hook 'tty-setup-hook #'xterm-mouse-mode)
#+end_src
*** X11 clipboard support
#+begin_src emacs-lisp
  (straight-use-package 'xclip)
  (autoload 'xclip-mode "xclip" "Minor mode to use the ‘xclip’ program to copy&paste." t)
  (add-hook 'tty-setup-hook #'xclip-mode)
#+end_src
*** Evil cursor shape
#+begin_src emacs-lisp
  (straight-use-package 'evil-terminal-cursor-changer)
  (autoload 'etcc-mode "evil-terminal-cursor-changer")
  (add-hook 'tty-setup-hook #'etcc-mode)
  (with-eval-after-load "evil"
    (with-eval-after-load "evil-terminal-cursor-changer"
      (add-hook 'kill-emacs-hook
                (lambda ()
                  (evil-set-cursor t)
                  (etcc--evil-set-cursor)))))
#+end_src
*** etcc + diff-hl patch
#+begin_src emacs-lisp
  (with-eval-after-load "diff-hl"
    (with-eval-after-load "evil-terminal-cursor-changer"
      (advice-add 'diff-hl-flydiff-update :after #'etcc--evil-set-cursor)))
#+end_src

